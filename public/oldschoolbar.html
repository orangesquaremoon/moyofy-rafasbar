<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OLD SCHOOL BAR ROCK ¬∑ San Jos√©, Barrio Chino</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=UnifrakturMaguntia&family=Metal+Mania&family=Grenze+Gotisch:wght@400;700&family=IM+Fell+DW+Pica&display=swap" rel="stylesheet">
  <style>
    :root {
      --blood: #8b0000;
      --blood-dark: #5a0000;
      --blood-light: #c00000;
      --metal: #2a2a2a;
      --metal-dark: #121212;
      --metal-light: #3a3a3a;
      --rust: #8a3324;
      --rust-dark: #5a1f16;
      --steel: #b0b0b0;
      --steel-light: #d0d0d0;
      --neon-red: #ff003c;
      --neon-blue: #00e1ff;
      --flame: #ff6a00;
      --flame-dark: #cc5500;
      --void: #000000;
      --gothic-purple: #4a004a;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      color: var(--steel-light);
      min-height: 100vh;
      background: 
        radial-gradient(circle at 20% 30%, var(--metal-dark) 0%, var(--void) 70%),
        repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(90, 0, 0, 0.1) 2px, rgba(90, 0, 0, 0.1) 4px);
      font-family: 'IM Fell DW Pica', serif;
      overflow-x: hidden;
      position: relative;
    }

    /* Efectos de fondo metal */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        url("https://i.ibb.co/R4BxCmMs/oldschoollogo.jpg"),
        radial-gradient(circle at 50% 20%, rgba(139, 0, 0, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(255, 106, 0, 0.1) 0%, transparent 50%);
      background-blend-mode: screen;
      background-size: 300px, cover, cover;
      background-position: center 80px, center, center;
      background-repeat: no-repeat;
      z-index: -1;
      opacity: 0.3;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      position: relative;
      z-index: 1;
    }

    /* Header G√≥tico */
    header {
      text-align: center;
      margin-bottom: 30px;
      animation: skullAppear 2s ease;
      position: relative;
      padding-top: 20px;
    }

    @keyframes skullAppear {
      0% { opacity: 0; transform: translateY(-50px) scale(0.8); }
      70% { opacity: 0.7; transform: translateY(10px) scale(1.05); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }

    .logo-container {
      position: relative;
      margin-bottom: 10px;
    }

    .logo-bg {
      position: absolute;
      width: 100%;
      height: 100%;
      background: radial-gradient(ellipse at center, var(--blood) 0%, transparent 70%);
      filter: blur(20px);
      z-index: -1;
      opacity: 0.7;
    }

    h1 {
      font-family: 'Metal Mania', cursive;
      font-size: 4.5rem;
      margin-bottom: 5px;
      color: var(--steel-light);
      text-shadow: 
        0 0 10px var(--neon-red),
        0 0 20px var(--neon-red),
        0 0 30px var(--blood),
        3px 3px 0 var(--void),
        6px 6px 0 rgba(139, 0, 0, 0.5);
      letter-spacing: 3px;
      position: relative;
      z-index: 2;
      animation: metalPulse 3s infinite alternate;
    }

    @keyframes metalPulse {
      0% { text-shadow: 0 0 10px var(--neon-red), 0 0 20px var(--neon-red), 0 0 30px var(--blood), 3px 3px 0 var(--void), 6px 6px 0 rgba(139, 0, 0, 0.5); }
      100% { text-shadow: 0 0 15px var(--neon-red), 0 0 30px var(--neon-red), 0 0 45px var(--blood), 3px 3px 0 var(--void), 6px 6px 0 rgba(139, 0, 0, 0.5); }
    }

    h2 {
      font-family: 'Grenze Gotisch', cursive;
      font-size: 1.8rem;
      color: var(--steel);
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 2px;
      position: relative;
    }

    h2::before, h2::after {
      content: '‚ò†';
      margin: 0 15px;
      color: var(--blood);
      font-size: 1.5rem;
    }

    .location {
      font-family: 'IM Fell DW Pica', serif;
      color: var(--rust);
      font-size: 1.2rem;
      margin-top: 5px;
      letter-spacing: 1px;
    }

    /* Cards con estilo de tumba */
    .card {
      background: 
        linear-gradient(145deg, rgba(42, 42, 42, 0.95), rgba(18, 18, 18, 0.95)),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path d="M0,0 L100,0 L100,100 L0,100 Z" fill="none" stroke="%235a0000" stroke-width="2" stroke-dasharray="5,5"/></svg>');
      border: 3px solid var(--rust);
      border-image: linear-gradient(45deg, var(--rust), var(--blood), var(--rust-dark)) 1;
      border-radius: 0;
      padding: 25px;
      margin-bottom: 25px;
      position: relative;
      box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.8),
        inset 0 0 0 1px rgba(255, 255, 255, 0.05);
      transition: all 0.3s ease;
      transform-style: preserve-3d;
    }

    .card::before {
      content: '';
      position: absolute;
      top: -3px;
      left: -3px;
      right: -3px;
      bottom: -3px;
      background: linear-gradient(45deg, transparent, rgba(139, 0, 0, 0.3), transparent);
      z-index: -1;
      opacity: 0;
      transition: opacity 0.5s;
    }

    .card:hover {
      transform: translateY(-5px) rotateX(1deg) rotateY(1deg);
      box-shadow: 
        0 15px 40px rgba(139, 0, 0, 0.4),
        inset 0 0 0 1px rgba(255, 255, 255, 0.1);
    }

    .card:hover::before {
      opacity: 1;
    }

    .card-header {
      font-family: 'Grenze Gotisch', cursive;
      font-size: 1.8rem;
      color: var(--steel-light);
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 2px;
      border-bottom: 2px solid var(--rust);
      padding-bottom: 8px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .card-header i {
      color: var(--neon-red);
      text-shadow: 0 0 5px var(--blood);
    }

    /* Botones de metal */
    .btn {
      width: 100%;
      padding: 18px;
      background: 
        linear-gradient(to bottom, var(--metal-light), var(--metal-dark)),
        repeating-linear-gradient(45deg, transparent, transparent 2px, rgba(139, 0, 0, 0.3) 2px, rgba(139, 0, 0, 0.3) 4px);
      color: var(--steel-light);
      border: 2px solid var(--rust);
      border-radius: 0;
      font-family: 'Metal Mania', cursive;
      font-size: 1.3rem;
      font-weight: normal;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      letter-spacing: 1px;
      text-transform: uppercase;
      position: relative;
      overflow: hidden;
      box-shadow: 
        0 5px 15px rgba(0, 0, 0, 0.7),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 0, 60, 0.3), transparent);
      transition: left 0.7s;
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn:hover {
      background: 
        linear-gradient(to bottom, var(--blood-dark), var(--metal-dark)),
        repeating-linear-gradient(45deg, transparent, transparent 2px, rgba(255, 0, 60, 0.5) 2px, rgba(255, 0, 60, 0.5) 4px);
      color: white;
      border-color: var(--neon-red);
      box-shadow: 
        0 8px 25px rgba(139, 0, 0, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.2),
        0 0 15px rgba(255, 0, 60, 0.4);
      transform: translateY(-3px);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: 
        0 3px 10px rgba(0, 0, 0, 0.7),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .btn-secondary {
      background: 
        linear-gradient(to bottom, rgba(42, 42, 42, 0.8), rgba(18, 18, 18, 0.8)),
        repeating-linear-gradient(45deg, transparent, transparent 2px, rgba(0, 225, 255, 0.2) 2px, rgba(0, 225, 255, 0.2) 4px);
      border-color: var(--neon-blue);
    }

    .btn-secondary:hover {
      background: 
        linear-gradient(to bottom, rgba(0, 100, 139, 0.8), rgba(18, 18, 18, 0.8)),
        repeating-linear-gradient(45deg, transparent, transparent 2px, rgba(0, 225, 255, 0.5) 2px, rgba(0, 225, 255, 0.5) 4px);
      border-color: var(--neon-blue);
      box-shadow: 
        0 8px 25px rgba(0, 100, 139, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.2),
        0 0 15px rgba(0, 225, 255, 0.4);
    }

    /* Inputs con estilo industrial */
    .input-metal {
      width: 100%;
      padding: 15px;
      background: 
        linear-gradient(to bottom, rgba(30, 30, 30, 0.9), rgba(10, 10, 10, 0.9)),
        repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(139, 0, 0, 0.2) 1px, rgba(139, 0, 0, 0.2) 3px);
      color: var(--steel-light);
      border: 2px solid var(--rust);
      border-radius: 0;
      font-family: 'IM Fell DW Pica', serif;
      font-size: 1.1rem;
      transition: all 0.3s;
      box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.7);
    }

    .input-metal:focus {
      outline: none;
      border-color: var(--neon-red);
      box-shadow: 
        inset 0 2px 5px rgba(0, 0, 0, 0.7),
        0 0 10px rgba(255, 0, 60, 0.5);
      background: 
        linear-gradient(to bottom, rgba(40, 40, 40, 0.9), rgba(15, 15, 15, 0.9)),
        repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255, 0, 60, 0.3) 1px, rgba(255, 0, 60, 0.3) 3px);
    }

    .input-metal::placeholder {
      color: var(--rust);
      font-style: italic;
    }

    /* Pills de estado */
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 15px;
      border-radius: 0;
      font-family: 'IM Fell DW Pica', serif;
      font-weight: bold;
      font-size: 0.9rem;
      border: 1px solid var(--rust);
      background: 
        linear-gradient(to bottom, rgba(42, 42, 42, 0.9), rgba(28, 28, 28, 0.9));
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .pill-blood {
      color: var(--blood-light);
      border-color: var(--blood);
      background: 
        linear-gradient(to bottom, rgba(139, 0, 0, 0.2), rgba(90, 0, 0, 0.2));
      text-shadow: 0 0 5px rgba(255, 0, 60, 0.5);
    }

    .pill-flame {
      color: var(--flame);
      border-color: var(--flame-dark);
      background: 
        linear-gradient(to bottom, rgba(255, 106, 0, 0.2), rgba(204, 85, 0, 0.2));
    }

    .pill-steel {
      color: var(--steel);
      border-color: var(--steel);
      background: 
        linear-gradient(to bottom, rgba(176, 176, 176, 0.1), rgba(112, 112, 112, 0.1));
    }

    /* Display de puntos - Estilo de caldero */
    .points-display {
      font-family: 'Metal Mania', cursive;
      font-size: 3rem;
      text-align: center;
      margin: 20px 0;
      color: var(--flame);
      text-shadow: 
        0 0 10px var(--flame),
        0 0 20px var(--blood),
        0 0 30px var(--blood-dark);
      position: relative;
      animation: flameFlicker 2s infinite alternate;
    }

    @keyframes flameFlicker {
      0%, 100% { 
        text-shadow: 
          0 0 10px var(--flame),
          0 0 20px var(--blood),
          0 0 30px var(--blood-dark);
      }
      50% { 
        text-shadow: 
          0 0 15px var(--flame),
          0 0 25px var(--blood),
          0 0 35px var(--blood-dark),
          0 0 45px var(--rust);
      }
    }

    .points-display::before, .points-display::after {
      content: '‚öî';
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 2rem;
      color: var(--steel);
    }

    .points-display::before {
      left: 10%;
    }

    .points-display::after {
      right: 10%;
    }

    /* Level badge - Estilo de bandas metal */
    .level-badge {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      background: 
        linear-gradient(45deg, var(--blood-dark), var(--metal-dark), var(--blood-dark)),
        repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255, 0, 60, 0.3) 5px, rgba(255, 0, 60, 0.3) 10px);
      color: var(--steel-light);
      padding: 10px 20px;
      border: 2px solid var(--rust);
      font-family: 'Metal Mania', cursive;
      font-size: 1.2rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.7);
      animation: badgePulse 4s infinite;
    }

    @keyframes badgePulse {
      0%, 100% { 
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.7);
      }
      50% { 
        box-shadow: 0 5px 20px rgba(139, 0, 0, 0.5), 0 0 20px rgba(255, 0, 60, 0.3);
      }
    }

    .level-badge::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.7s;
    }

    .level-badge:hover::before {
      left: 100%;
    }

    /* Progress bar con cuchillas */
    .progress-container {
      background: 
        linear-gradient(to bottom, rgba(20, 20, 20, 0.9), rgba(10, 10, 10, 0.9)),
        repeating-linear-gradient(90deg, transparent, transparent 3px, rgba(139, 0, 0, 0.2) 3px, rgba(139, 0, 0, 0.2) 6px);
      border: 2px solid var(--rust);
      padding: 15px;
      margin: 15px 0;
      position: relative;
      box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.8);
    }

    .progress-bar {
      height: 20px;
      background: 
        linear-gradient(to bottom, var(--metal), var(--metal-dark));
      border: 1px solid var(--rust-dark);
      position: relative;
      overflow: hidden;
      box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.8);
    }

    .progress-fill {
      height: 100%;
      background: 
        linear-gradient(90deg, var(--blood), var(--flame), var(--blood)),
        repeating-linear-gradient(45deg, transparent, transparent 5px, rgba(255, 255, 255, 0.1) 5px, rgba(255, 255, 255, 0.1) 10px);
      transition: width 1s cubic-bezier(0.22, 0.61, 0.36, 1);
      position: relative;
      box-shadow: inset 0 0 10px rgba(255, 0, 60, 0.5);
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      animation: progressShine 2s infinite;
    }

    @keyframes progressShine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* Items de canciones - Estilo de cat√°logo de bandas */
    .song-item {
      background: 
        linear-gradient(to bottom, rgba(35, 35, 35, 0.9), rgba(25, 25, 25, 0.9)),
        repeating-linear-gradient(45deg, transparent, transparent 2px, rgba(139, 0, 0, 0.1) 2px, rgba(139, 0, 0, 0.1) 4px);
      border-left: 5px solid var(--blood);
      padding: 15px;
      margin: 12px 0;
      border-right: 1px solid rgba(139, 0, 0, 0.3);
      position: relative;
      transition: all 0.3s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.5);
    }

    .song-item:hover {
      background: 
        linear-gradient(to bottom, rgba(45, 45, 45, 0.9), rgba(30, 30, 30, 0.9)),
        repeating-linear-gradient(45deg, transparent, transparent 2px, rgba(255, 0, 60, 0.2) 2px, rgba(255, 0, 60, 0.2) 4px);
      border-left-color: var(--neon-red);
      transform: translateX(5px);
      box-shadow: 0 5px 15px rgba(139, 0, 0, 0.4);
    }

    .song-item::before {
      content: '‚ô´';
      position: absolute;
      left: -15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--blood);
      font-size: 1.5rem;
      opacity: 0.7;
    }

    .song-info {
      flex: 1;
      min-width: 0;
    }

    .song-title {
      font-family: 'Grenze Gotisch', cursive;
      font-size: 1.2rem;
      color: var(--steel-light);
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .song-artist {
      font-family: 'IM Fell DW Pica', serif;
      color: var(--rust);
      font-size: 1rem;
      font-style: italic;
    }

    /* Grid de estad√≠sticas */
    .grid3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin: 20px 0;
    }

    @media (max-width: 768px) {
      .grid3 {
        grid-template-columns: 1fr;
      }
    }

    .stat-tile {
      background: 
        linear-gradient(145deg, rgba(30, 30, 30, 0.9), rgba(20, 20, 20, 0.9));
      border: 1px solid var(--rust);
      padding: 15px;
      text-align: center;
      position: relative;
      transition: all 0.3s;
    }

    .stat-tile:hover {
      border-color: var(--neon-red);
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(139, 0, 0, 0.3);
    }

    .stat-tile .label {
      font-family: 'IM Fell DW Pica', serif;
      color: var(--rust);
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .stat-tile .value {
      font-family: 'Metal Mania', cursive;
      font-size: 1.8rem;
      color: var(--steel-light);
      text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
    }

    /* Efectos de fuego */
    .fire-effect {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100px;
      background: 
        linear-gradient(to top, 
          rgba(255, 106, 0, 0.4) 0%,
          rgba(255, 0, 60, 0.2) 20%,
          transparent 100%);
      pointer-events: none;
      z-index: -1;
      animation: fireFlicker 3s infinite alternate;
    }

    @keyframes fireFlicker {
      0%, 100% { 
        opacity: 0.7;
        background: 
          linear-gradient(to top, 
            rgba(255, 106, 0, 0.4) 0%,
            rgba(255, 0, 60, 0.2) 20%,
            transparent 100%);
      }
      50% { 
        opacity: 0.9;
        background: 
          linear-gradient(to top, 
            rgba(255, 0, 60, 0.5) 0%,
            rgba(255, 106, 0, 0.3) 20%,
            transparent 100%);
      }
    }

    /* Animaciones de calaveras */
    .skull-animation {
      position: fixed;
      font-size: 3rem;
      color: var(--steel);
      opacity: 0.1;
      z-index: -1;
      animation: skullFloat 20s infinite linear;
    }

    @keyframes skullFloat {
      0% { 
        transform: translate(0, 0) rotate(0deg); 
        opacity: 0.1;
      }
      25% { 
        transform: translate(100vw, 50vh) rotate(90deg); 
        opacity: 0.05;
      }
      50% { 
        transform: translate(50vw, 100vh) rotate(180deg); 
        opacity: 0.1;
      }
      75% { 
        transform: translate(-50vw, 50vh) rotate(270deg); 
        opacity: 0.05;
      }
      100% { 
        transform: translate(0, 0) rotate(360deg); 
        opacity: 0.1;
      }
    }

    /* Panel de sonido */
    .sound-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      background: 
        radial-gradient(circle at center, var(--metal), var(--metal-dark));
      border: 2px solid var(--rust);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 100;
      transition: all 0.3s;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.7);
    }

    .sound-toggle:hover {
      border-color: var(--neon-red);
      box-shadow: 
        0 5px 20px rgba(139, 0, 0, 0.5),
        0 0 15px rgba(255, 0, 60, 0.3);
      transform: scale(1.1);
    }

    .sound-toggle i {
      font-size: 1.5rem;
      color: var(--steel-light);
    }

    /* Mensajes de sistema */
    .message {
      padding: 15px;
      margin: 15px 0;
      border: 2px solid;
      font-family: 'IM Fell DW Pica', serif;
      text-align: center;
      position: relative;
      animation: messageAppear 0.5s ease;
    }

    @keyframes messageAppear {
      0% { opacity: 0; transform: translateY(-10px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .message-blood {
      background: 
        linear-gradient(to bottom, rgba(139, 0, 0, 0.2), rgba(90, 0, 0, 0.2));
      border-color: var(--blood);
      color: var(--blood-light);
    }

    .message-flame {
      background: 
        linear-gradient(to bottom, rgba(255, 106, 0, 0.2), rgba(204, 85, 0, 0.2));
      border-color: var(--flame);
      color: var(--flame);
    }

    .message-steel {
      background: 
        linear-gradient(to bottom, rgba(176, 176, 176, 0.1), rgba(112, 112, 112, 0.1));
      border-color: var(--steel);
      color: var(--steel-light);
    }

    /* Footer */
    footer {
      text-align: center;
      margin-top: 40px;
      padding: 20px;
      border-top: 2px solid var(--rust);
      color: var(--rust);
      font-family: 'IM Fell DW Pica', serif;
      font-size: 0.9rem;
      letter-spacing: 1px;
    }

    /* Animaci√≥n de entrada */
    .intro-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at center, var(--void) 0%, var(--metal-dark) 100%),
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"><path d="M20,20 L180,20 L180,180 L20,180 Z" fill="none" stroke="%235a0000" stroke-width="2" stroke-dasharray="10,10"/></svg>');
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      transition: opacity 1s ease;
    }

    .intro-title {
      font-family: 'Metal Mania', cursive;
      font-size: 5rem;
      color: var(--steel-light);
      text-align: center;
      text-shadow: 
        0 0 10px var(--neon-red),
        0 0 20px var(--neon-red),
        0 0 30px var(--blood),
        5px 5px 0 var(--void);
      margin-bottom: 20px;
      letter-spacing: 5px;
      animation: introPulse 2s infinite alternate;
    }

    @keyframes introPulse {
      0% { 
        text-shadow: 
          0 0 10px var(--neon-red),
          0 0 20px var(--neon-red),
          0 0 30px var(--blood),
          5px 5px 0 var(--void);
      }
      100% { 
        text-shadow: 
          0 0 20px var(--neon-red),
          0 0 40px var(--neon-red),
          0 0 60px var(--blood),
          5px 5px 0 var(--void),
          0 0 80px rgba(139, 0, 0, 0.5);
      }
    }

    .intro-subtitle {
      font-family: 'Grenze Gotisch', cursive;
      font-size: 1.8rem;
      color: var(--rust);
      text-align: center;
      max-width: 800px;
      line-height: 1.5;
      margin-bottom: 40px;
      text-transform: uppercase;
      letter-spacing: 3px;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }
      
      h1 {
        font-size: 2.8rem;
      }
      
      h2 {
        font-size: 1.4rem;
      }
      
      .intro-title {
        font-size: 3rem;
      }
      
      .points-display {
        font-size: 2.2rem;
      }
      
      .card-header {
        font-size: 1.4rem;
      }
    }
  </style>
</head>

<body>
  <!-- Efectos de fondo -->
  <div class="fire-effect"></div>
  <div class="skull-animation" style="top: 10%; left: 5%;">‚ò†</div>
  <div class="skull-animation" style="top: 30%; left: 80%; animation-delay: -5s;">‚ò†</div>
  <div class="skull-animation" style="top: 70%; left: 20%; animation-delay: -10s;">‚ò†</div>
  <div class="skull-animation" style="top: 80%; left: 70%; animation-delay: -15s;">‚ò†</div>

  <!-- Pantalla de inicio -->
  <div class="intro-screen" id="intro-screen">
    <div class="logo-bg"></div>
    <h1 class="intro-title">OLD SCHOOL BAR ROCK</h1>
    <p class="intro-subtitle">EL TEMPLO DEL METAL EN SAN JOS√â ¬∑ BARRIO CHINO</p>
    <button class="btn" id="btn-start">
      <i class="fas fa-skull-crossbones"></i> ENTRAR AL INFRAMUNDO
    </button>
    <div style="margin-top: 50px; text-align: center; max-width: 800px;">
      <div style="display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
        <span class="pill pill-blood"><i class="fas fa-guitar"></i> Metal Extremo</span>
        <span class="pill pill-flame"><i class="fas fa-fire"></i> Vibra Rock</span>
        <span class="pill pill-steel"><i class="fas fa-volume-up"></i> Sonido Brutal</span>
      </div>
      <p style="font-family: 'IM Fell DW Pica', serif; color: var(--steel); font-size: 1.1rem; line-height: 1.6;">
         Solo metal. Entr√° por QR. Suger√≠ canciones extremas. Gan√° gotas de sangre. Sub√≠ en el ranking infernal. Envi√° ofrendas a otros headbangers.
      </p>
    </div>
  </div>

  <!-- Bot√≥n de sonido -->
  <div class="sound-toggle" id="sound-toggle" title="Activar/Desactivar sonido">
    <i class="fas fa-volume-up" id="sound-icon"></i>
  </div>

  <!-- Contenido principal -->
  <div class="container" id="main-container" style="display:none;">
    <header>
      <div class="logo-container">
        <div class="logo-bg"></div>
        <h1>OLD SCHOOL BAR ROCK</h1>
      </div>
      <h2>EL TEMPLO DEL METAL</h2>
      <p class="location">San Jos√©, Barrio Chino ¬∑ Desde las sombras</p>
      <div style="margin-top: 15px;">
        <span class="pill pill-blood" id="pill-conn"><i class="fas fa-wifi"></i> Conectando al abismo...</span>
      </div>
    </header>

    <!-- Panel de usuario -->
    <div class="card">
      <div id="onboarding" style="display:none;">
        <div class="card-header">
          <span><i class="fas fa-user-ninja"></i> ENTR√Å CON TU NOMBRE DE GUERRA</span>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
          <div class="stat-tile">
            <div class="label">Apodo (para el ranking)</div>
            <input type="text" id="nickname" placeholder="Ej: MetalDestroyer" class="input-metal" autocomplete="off" maxlength="24">
            <div style="margin-top: 10px; font-size: 0.9rem; color: var(--rust);">
              <i class="fas fa-exclamation-triangle"></i> No uses tu nombre real en el Inframundo.
            </div>
          </div>
          <div class="stat-tile">
            <div class="label">Correo (opcional)</div>
            <input type="email" id="email" placeholder="Ej: metalhead@dominio.com" class="input-metal" autocomplete="email" maxlength="80">
            <div style="margin-top: 10px; font-size: 0.9rem; color: var(--rust);">
              <i class="fas fa-lock"></i> Para recuperar tu alma en el futuro.
            </div>
          </div>
        </div>

        <div style="display: flex; gap: 15px; margin-top: 20px;">
          <button class="btn grow" id="btn-enter">
            <i class="fas fa-skull"></i> ENTRAR AL RITUAL
          </button>
          <button class="btn btn-secondary grow" id="btn-guest">
            <i class="fas fa-ghost"></i> ENTRAR COMO ESPECTRO
          </button>
        </div>
        <div id="message-onboarding"></div>
      </div>

      <div id="profile" style="display:none;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <div>
            <div style="font-family: 'Grenze Gotisch', cursive; font-size: 1.4rem; color: var(--steel-light);">
              ¬°Bienvenido, <span id="user-nickname" style="color: var(--blood-light);">headbanger</span>!
            </div>
            <div style="margin-top: 8px; font-family: 'IM Fell DW Pica', serif; color: var(--rust);">
              <i class="fas fa-id-card"></i> <span id="user-id">‚Äî</span>
              <span style="margin: 0 10px;">‚öî</span>
              <i class="fas fa-fire"></i> <span id="user-streak">‚Äî</span>
            </div>
          </div>
          <div>
            <span class="pill pill-blood" id="pill-live"><i class="fas fa-bolt"></i> EN DIRECTO</span>
          </div>
        </div>

        <div class="points-display">
          <span id="user-points">666</span> GOTAS DE SANGRE
        </div>

        <div style="display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
          <span class="level-badge"><i class="fas fa-level-up-alt"></i> NIVEL <span id="user-level">1</span></span>
          <span class="pill pill-flame"><i class="fas fa-guitar"></i> <span id="songs-added">0</span> CANCIONES</span>
          <span class="pill pill-steel"><i class="fas fa-thumbs-up"></i> <span id="votes-received">0</span> VOTOS</span>
        </div>

        <div class="progress-container">
          <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-family: 'IM Fell DW Pica', serif; color: var(--rust);">
            <span id="current-level-display">Nivel 1</span>
            <span id="next-level-display">Nivel 2</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="level-progress-fill" style="width: 0%"></div>
          </div>
          <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 0.9rem; color: var(--steel);">
            <span id="current-xp-display">0/100 XP</span>
            <span id="xp-to-next">100 XP para subir</span>
          </div>
        </div>

        <div style="height: 2px; background: linear-gradient(90deg, transparent, var(--rust), transparent); margin: 20px 0;"></div>

        <div class="grid3">
          <div class="stat-tile">
            <div class="label">Ranking Infernal</div>
            <div class="value" style="font-size: 1.3rem;" id="top1">‚Äî</div>
            <div style="font-size: 0.9rem; color: var(--rust);" id="top2">‚Äî</div>
            <div style="font-size: 0.9rem; color: var(--rust);" id="top3">‚Äî</div>
          </div>

          <div class="stat-tile">
            <div class="label">Ofrendas</div>
            <div class="value" id="gift-count">0</div>
            <div style="font-size: 0.9rem; color: var(--rust);">Enviadas hoy</div>
          </div>

          <div class="stat-tile">
            <div class="label">Modo</div>
            <div class="value" style="font-size: 1.3rem;" id="priority-mode">NORMAL</div>
            <div style="font-size: 0.9rem; color: var(--rust);">Sub√≠ prioridad con sangre</div>
          </div>
        </div>

        <div style="display: flex; gap: 15px; margin-top: 20px;">
          <button class="btn btn-secondary grow" id="btn-change">
            <i class="fas fa-user-edit"></i> CAMBIAR NOMBRE
          </button>
          <button class="btn grow" id="btn-refresh">
            <i class="fas fa-sync-alt"></i> SINCRONIZAR
          </button>
        </div>

        <div id="message-profile"></div>
      </div>
    </div>

    <!-- B√∫squeda de canciones -->
    <div class="card">
      <div class="card-header">
        <span><i class="fas fa-search"></i> BUSCAR CANCI√ìN EXTREMA</span>
        <div style="display: flex; gap: 10px;">
          <span class="pill pill-flame" title="M√°ximo 8 minutos por canci√≥n"><i class="fas fa-hourglass-half"></i> 8 MIN</span>
          <span class="pill pill-blood" title="Filtro Metal/Thrash/Death"><i class="fas fa-filter"></i> METAL DEFENDER</span>
        </div>
      </div>

      <div style="margin: 15px 0; line-height: 1.6; color: var(--steel); font-family: 'IM Fell DW Pica', serif;">
        Suger√≠ canciones con vibra metal/thrash/death/black. Gan√°s gotas de sangre por sugerencias v√°lidas.
        <div style="margin-top: 8px;">
          <i class="fas fa-keyboard"></i> <span style="color: var(--blood-light);">Tip:</span> presion√° <span style="background: var(--metal); padding: 2px 6px; border: 1px solid var(--rust);">Enter</span> para buscar.
        </div>
      </div>

      <div style="margin: 20px 0;">
        <input type="text" id="song-search" placeholder="Busca tu canci√≥n metalera..." class="input-metal" autocomplete="off" />
      </div>

      <div style="margin: 20px 0;">
        <button class="btn" id="btn-search">
          <i class="fas fa-search"></i> BUSCAR CANCIONES
        </button>
      </div>

      <div id="auth-required-message" style="display:none;" class="message message-blood">
        <i class="fas fa-lock"></i> <strong>üîê NECESIT√ÅS AUTORIZAR YOUTUBE</strong><br>
        Para agregar canciones a la playlist, autoriz√° OLD SCHOOL BAR ROCK con tu cuenta de Google.<br>
        <small>(Solo una vez por sesi√≥n)</small>
      </div>

      <div id="message-container"></div>

      <div id="results-container">
        <div style="text-align: center; padding: 30px; color: var(--rust);">
          <div style="font-size: 3rem; margin-bottom: 15px; color: var(--blood);">‚ò†</div>
          <p style="font-family: 'Grenze Gotisch', cursive; font-size: 1.3rem;">¬øQU√â CANCI√ìN QUER√âS AGREGAR HOY?</p>
          <p style="margin-top: 10px; font-family: 'IM Fell DW Pica', serif;">Entr√° con tu nombre de guerra para aparecer en el ranking infernal.</p>
        </div>
      </div>

      <div style="height: 2px; background: linear-gradient(90deg, transparent, var(--rust), transparent); margin: 25px 0;"></div>

      <!-- Sistema de ofrendas -->
      <div class="card" style="margin: 0; border-color: var(--neon-blue); background: rgba(10, 10, 20, 0.8);">
        <div class="card-header">
          <span><i class="fas fa-gift"></i> OFRENDAS VIRTUALES</span>
          <span class="pill pill-blood"><i class="fas fa-bolt"></i> EN DIRECTO</span>
        </div>
        
        <div style="margin: 15px 0; line-height: 1.6; color: var(--steel); font-family: 'IM Fell DW Pica', serif;">
          Envi√° gotas de sangre a otros headbangers. Esto activa animaciones y suma al ranking infernal.
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
          <div class="stat-tile">
            <div class="label">Enviar a (apodo)</div>
            <input type="text" id="gift-to" placeholder="Ej: ThrashMaster" class="input-metal" autocomplete="off" maxlength="24">
          </div>
          <div class="stat-tile">
            <div class="label">Ofrenda</div>
            <select id="gift-type" class="input-metal" style="appearance: none;">
              <option value="beer">üç∫ Cerveza negra (+10)</option>
              <option value="shot">üî• Shot infernal (+25)</option>
              <option value="crown">üëë Corona de espinas (+50)</option>
              <option value="pentagram">‚≠ê Pentagrama sangriento (+80)</option>
            </select>
          </div>
        </div>

        <div style="display: flex; gap: 15px; margin-top: 20px;">
          <button class="btn btn-secondary grow" id="btn-send-gift">
            <i class="fas fa-paper-plane"></i> ENVIAR OFRENDA
          </button>
          <button class="btn grow" id="btn-open-leaderboard">
            <i class="fas fa-trophy"></i> VER RANKING
          </button>
        </div>

        <div id="message-gifts"></div>
      </div>
    </div>

    <footer>
      <p>OLD SCHOOL BAR ROCK ¬∑ San Jos√©, Barrio Chino ¬∑ ¬© 2025 - LA LEYENDA CONTIN√öA</p>
      <p style="margin-top: 10px; font-size: 0.8rem;">M√∫sica v√≠a YouTube ¬∑ L√≠mite 8 min ¬∑ Econom√≠a de sangre ¬∑ Ranking infernal en vivo</p>
    </footer>
  </div>

  <!-- Elementos de efectos visuales -->
  <div id="confetti-container" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999;"></div>

  <!-- Sonidos -->
  <audio id="success-sound" preload="auto"><source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg"></audio>
  <audio id="level-up-sound" preload="auto"><source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-trumpet-2018.mp3" type="audio/mpeg"></audio>
  <audio id="click-sound" preload="auto"><source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg"></audio>
  <audio id="explosion-sound" preload="auto"><source src="https://assets.mixkit.co/sfx/preview/mixkit-fireworks-explosion-3038.mp3" type="audio/mpeg"></audio>
  <audio id="metal-sound" preload="auto"><source src="https://assets.mixkit.co/sfx/preview/mixkit-metal-sword-strike-1492.mp3" type="audio/mpeg"></audio>

  <!-- SDK Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // Configuraci√≥n del Bar Metal
    const BAR_LOCATION = { lat: 9.93422, lng: -84.06894 };
    const RADIUS_METERS = 20000;
    const GEOLOCATION_REQUIRED = false;
    const COOLDOWN_MS = 5 * 60 * 1000;
    const MAX_DURATION_MINUTES = 8;
    const MAX_DURATION_SECONDS = MAX_DURATION_MINUTES * 60;

    // Estado global
    let soundEnabled = true;
    let currentUser = null;
    let API_BASE = window.location.origin;
    let requiresAuth = false;
    let lastLevel = 1;
    let SUPABASE_URL = null;
    let SUPABASE_ANON_KEY = null;
    let BAR_ID = "oldschoolbar";
    let sbClient = null;
    let realtimeChannel = null;

    // Econom√≠a metalera
    const ECONOMY = {
      baseGiftValues: { beer: 10, shot: 25, crown: 50, pentagram: 80 },
      pointsPerSong: 15, // M√°s puntos para canciones metal
      xpPerLevel: 150, // M√°s dif√≠cil de subir nivel
      voteReward: 5, // M√°s puntos por votos
      giftSendCostMultiplier: 1
    };

    // Helper functions
    function $(id) { return document.getElementById(id); }
    function escapeHtml(str) {
      return String(str || '')
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'","&#039;");
    }
    function safeTrim(s) { return (s || '').toString().trim(); }
    function normalizeNickname(nick) {
      return safeTrim(nick).replace(/\s+/g, ' ').slice(0, 24);
    }

    // Sistema de sonido
    function playSound(soundId) {
      if (!soundEnabled) return;
      const sound = document.getElementById(soundId);
      if (!sound) return;
      try { 
        sound.currentTime = 0; 
        sound.play(); 
      } catch (e) {}
    }

    function toggleSound() {
      soundEnabled = !soundEnabled;
      const icon = $('sound-icon');
      icon.className = soundEnabled ? 'fas fa-volume-up' : 'fas fa-volume-mute';
      if (soundEnabled) playSound('click-sound');
    }

    // Efectos visuales metaleros
    function createBloodExplosion(x, y, intensity = 100) {
      playSound('explosion-sound');
      const container = $('confetti-container');
      
      // Crear part√≠culas de sangre
      for (let i = 0; i < intensity; i++) {
        const particle = document.createElement('div');
        particle.style.position = 'absolute';
        particle.style.width = `${Math.random() * 15 + 5}px`;
        particle.style.height = `${Math.random() * 15 + 5}px`;
        particle.style.left = `${x}px`;
        particle.style.top = `${y}px`;
        particle.style.borderRadius = Math.random() > 0.7 ? '50%' : '0';
        
        // Colores de sangre
        const bloodColors = ['#8b0000', '#5a0000', '#c00000', '#ff003c', '#8a3324'];
        particle.style.background = bloodColors[Math.floor(Math.random() * bloodColors.length)];
        particle.style.opacity = '0.9';
        
        // Animaci√≥n
        const angle = Math.random() * Math.PI * 2;
        const velocity = 2 + Math.random() * 3;
        const distance = 100 + Math.random() * 200;
        
        const keyframes = [
          { 
            transform: 'translate(0, 0) scale(1)', 
            opacity: 1 
          },
          { 
            transform: `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) scale(0.1)`, 
            opacity: 0 
          }
        ];
        
        particle.animate(keyframes, {
          duration: 1000 + Math.random() * 1000,
          easing: 'cubic-bezier(0.21, 0.61, 0.35, 1)'
        });
        
        container.appendChild(particle);
        setTimeout(() => particle.remove(), 2000);
      }
      
      // Efecto de onda de choque
      const shockwave = document.createElement('div');
      shockwave.style.position = 'absolute';
      shockwave.style.left = `${x}px`;
      shockwave.style.top = `${y}px`;
      shockwave.style.width = '0';
      shockwave.style.height = '0';
      shockwave.style.borderRadius = '50%';
      shockwave.style.border = '2px solid rgba(255, 0, 60, 0.7)';
      shockwave.style.transform = 'translate(-50%, -50%)';
      shockwave.style.boxShadow = '0 0 20px rgba(255, 0, 60, 0.5)';
      
      shockwave.animate([
        { width: '0', height: '0', opacity: 1 },
        { width: '200px', height: '200px', opacity: 0 }
      ], {
        duration: 800,
        easing: 'ease-out'
      });
      
      container.appendChild(shockwave);
      setTimeout(() => shockwave.remove(), 800);
    }

    function createPointsAnimation(x, y, points, label = "PUNTOS DE SANGRE") {
      playSound('metal-sound');
      const container = $('confetti-container');
      const el = document.createElement('div');
      el.style.position = 'absolute';
      el.style.left = `${x}px`;
      el.style.top = `${y}px`;
      el.style.fontFamily = "'Metal Mania', cursive";
      el.style.fontSize = '1.8rem';
      el.style.color = '#ff003c';
      el.style.textShadow = '0 0 10px rgba(255, 0, 60, 0.7)';
      el.style.pointerEvents = 'none';
      el.style.zIndex = '10001';
      el.style.transform = 'translate(-50%, -50%)';
      el.style.opacity = '1';
      el.textContent = `+${points} ${label}`;
      
      container.appendChild(el);
      
      // Animaci√≥n
      el.animate([
        { transform: 'translate(-50%, -50%) scale(0.8)', opacity: 0 },
        { transform: 'translate(-50%, -50%) scale(1.2)', opacity: 1 },
        { transform: 'translate(-50%, -150%) scale(1)', opacity: 1 },
        { transform: 'translate(-50%, -200%) scale(0.5)', opacity: 0 }
      ], {
        duration: 2000,
        easing: 'cubic-bezier(0.22, 0.61, 0.36, 1)'
      });
      
      setTimeout(() => el.remove(), 2000);
    }

    function showMessage(containerId, text, type = 'blood') {
      const container = $(containerId);
      if (!container) return;
      
      let icon = 'info-circle';
      if (type === 'blood') icon = 'tint';
      else if (type === 'flame') icon = 'fire';
      else if (type === 'steel') icon = 'shield-alt';
      
      container.innerHTML = `<div class="message message-${type}"><i class="fas fa-${icon}"></i> ${text}</div>`;
      
      setTimeout(() => {
        if (container) container.innerHTML = '';
      }, 5000);
    }

    // Sistema de niveles
    function calculateLevel(points) {
      const level = Math.floor(points / ECONOMY.xpPerLevel) + 1;
      const currentXp = points % ECONOMY.xpPerLevel;
      const xpPercentage = (currentXp / ECONOMY.xpPerLevel) * 100;
      const xpNeeded = ECONOMY.xpPerLevel - currentXp;
      return { level, currentXp, xpPercentage, xpNeeded, nextLevel: level + 1 };
    }

    // UI Management
    function setUIStateLoggedOut() {
      $('onboarding').style.display = 'block';
      $('profile').style.display = 'none';
    }

    function setUIStateLoggedIn() {
      $('onboarding').style.display = 'none';
      $('profile').style.display = 'block';
    }

    function updateProfileUI() {
      if (!currentUser) return;

      $('user-nickname').textContent = currentUser.nickname || 'headbanger';
      $('user-id').textContent = currentUser.public_id || '‚Äî';
      $('user-points').textContent = currentUser.points ?? 666;

      const stats = calculateLevel(currentUser.points ?? 666);
      $('user-level').textContent = stats.level;
      $('current-level-display').textContent = `Nivel ${stats.level}`;
      $('next-level-display').textContent = `Nivel ${stats.nextLevel}`;
      $('level-progress-fill').style.width = `${stats.xpPercentage}%`;
      $('current-xp-display').textContent = `${stats.currentXp}/${ECONOMY.xpPerLevel} XP`;
      $('xp-to-next').textContent = `${stats.xpNeeded} XP para subir`;

      $('songs-added').textContent = currentUser.songs_added ?? 0;
      $('votes-received').textContent = currentUser.votes_received ?? 0;

      const streakLabel = currentUser.streak_days ? `${currentUser.streak_days} d√≠a(s)` : '0 d√≠a(s)';
      $('user-streak').textContent = `Racha: ${streakLabel}`;

      if (stats.level > lastLevel) {
        triggerLevelUpAnimation(stats.level);
        lastLevel = stats.level;
      }
    }

    function triggerLevelUpAnimation(level) {
      playSound('level-up-sound');
      
      // Crear animaci√≥n de nivel
      const levelUp = document.createElement('div');
      levelUp.style.position = 'fixed';
      levelUp.style.top = '50%';
      levelUp.style.left = '50%';
      levelUp.style.transform = 'translate(-50%, -50%)';
      levelUp.style.fontFamily = "'Metal Mania', cursive";
      levelUp.style.fontSize = '5rem';
      levelUp.style.color = '#ff003c';
      levelUp.style.textShadow = '0 0 20px rgba(255, 0, 60, 0.8)';
      levelUp.style.zIndex = '10001';
      levelUp.style.pointerEvents = 'none';
      levelUp.textContent = `NIVEL ${level}!`;
      
      document.body.appendChild(levelUp);
      
      // Animaci√≥n
      levelUp.animate([
        { transform: 'translate(-50%, -50%) scale(0)', opacity: 0 },
        { transform: 'translate(-50%, -50%) scale(1.5)', opacity: 1 },
        { transform: 'translate(-50%, -50%) scale(1)', opacity: 1 },
        { transform: 'translate(-50%, -50%) scale(1.2)', opacity: 0.8 },
        { transform: 'translate(-50%, -50%) scale(1.5)', opacity: 0 }
      ], {
        duration: 3000,
        easing: 'cubic-bezier(0.22, 0.61, 0.36, 1)'
      });
      
      // Efecto de explosi√≥n
      createBloodExplosion(window.innerWidth / 2, window.innerHeight / 2, 200);
      
      setTimeout(() => levelUp.remove(), 3000);
    }

    // Funcionalidad principal
    function startGame() {
      playSound('click-sound');
      const intro = $('intro-screen');
      intro.style.opacity = '0';
      setTimeout(() => {
        intro.style.display = 'none';
        $('main-container').style.display = 'block';
        // Simular conexi√≥n
        $('pill-conn').innerHTML = '<i class="fas fa-cloud"></i> Conectado al abismo';
        $('pill-conn').className = 'pill pill-blood';
      }, 700);
    }

    // Inicializaci√≥n
    function init() {
      // Configurar botones de sonido
      $('sound-toggle').addEventListener('click', toggleSound);
      
      // Bot√≥n de inicio
      $('btn-start').addEventListener('click', startGame);
      
      // Botones de entrada
      $('btn-enter').addEventListener('click', () => {
        playSound('click-sound');
        const nickname = normalizeNickname($('nickname').value);
        if (nickname && nickname.length >= 3) {
          // Simular entrada exitosa
          currentUser = {
            nickname: nickname,
            public_id: 'METAL_' + Math.floor(Math.random() * 10000),
            points: 666,
            songs_added: 0,
            votes_received: 0,
            streak_days: 1
          };
          setUIStateLoggedIn();
          updateProfileUI();
          showMessage('message-profile', `Bienvenido al Inframundo, ${escapeHtml(nickname)}!`, 'blood');
          createBloodExplosion(window.innerWidth / 2, window.innerHeight / 2, 100);
        } else {
          showMessage('message-onboarding', 'Necesit√°s un nombre de guerra m√°s brutal (m√≠nimo 3 caracteres).', 'blood');
        }
      });
      
      $('btn-guest').addEventListener('click', () => {
        playSound('click-sound');
        currentUser = {
          nickname: 'Espectro' + Math.floor(Math.random() * 1000),
          public_id: 'GHOST_' + Math.floor(Math.random() * 10000),
          points: 666,
          songs_added: 0,
          votes_received: 0,
          streak_days: 0
        };
        setUIStateLoggedIn();
        updateProfileUI();
        showMessage('message-profile', 'Entrando como espectro...', 'steel');
      });
      
      // Botones de perfil
      $('btn-change').addEventListener('click', () => {
        playSound('click-sound');
        if (confirm('¬øCambiar nombre de guerra? Esto reiniciar√° tu progreso.')) {
          currentUser = null;
          setUIStateLoggedOut();
          showMessage('message-onboarding', 'Eleg√≠ un nuevo nombre para el Inframundo.', 'blood');
        }
      });
      
      $('btn-refresh').addEventListener('click', () => {
        playSound('click-sound');
        if (currentUser) {
          // Simular actualizaci√≥n
          currentUser.points += Math.floor(Math.random() * 10);
          updateProfileUI();
          showMessage('message-profile', 'Sincronizado con el abismo.', 'blood');
        }
      });
      
      // B√∫squeda de canciones
      $('btn-search').addEventListener('click', () => {
        playSound('click-sound');
        const query = safeTrim($('song-search').value);
        if (!query) {
          showMessage('message-container', 'Ingres√° el nombre de una banda o canci√≥n metalera.', 'blood');
          return;
        }
        if (!currentUser) {
          showMessage('message-container', 'Primero entr√° con tu nombre de guerra.', 'flame');
          setUIStateLoggedOut();
          return;
        }
        
        // Simular b√∫squeda
        $('results-container').innerHTML = `
          <div class="song-item">
            <div class="song-info">
              <div class="song-title">MASTER OF PUPPETS</div>
              <div class="song-artist">Metallica</div>
              <div style="margin-top: 8px; color: var(--rust); font-size: 0.9rem;">
                <i class="fas fa-clock"></i> 8:35 ‚Ä¢ Thrash Metal ‚Ä¢ 1986
              </div>
            </div>
            <button class="btn" style="min-width: 120px;" onclick="simulateAddSong(this)">
              <i class="fas fa-plus"></i> AGREGAR
            </button>
          </div>
          <div class="song-item">
            <div class="song-info">
              <div class="song-title">IRON MAN</div>
              <div class="song-artist">Black Sabbath</div>
              <div style="margin-top: 8px; color: var(--rust); font-size: 0.9rem;">
                <i class="fas fa-clock"></i> 5:55 ‚Ä¢ Heavy Metal ‚Ä¢ 1970
              </div>
            </div>
            <button class="btn" style="min-width: 120px;" onclick="simulateAddSong(this)">
              <i class="fas fa-plus"></i> AGREGAR
            </button>
          </div>
          <div class="song-item">
            <div class="song-info">
              <div class="song-title">Raining Blood</div>
              <div class="song-artist">Slayer</div>
              <div style="margin-top: 8px; color: var(--rust); font-size: 0.9rem;">
                <i class="fas fa-clock"></i> 4:14 ‚Ä¢ Thrash Metal ‚Ä¢ 1986
              </div>
            </div>
            <button class="btn" style="min-width: 120px;" onclick="simulateAddSong(this)">
              <i class="fas fa-plus"></i> AGREGAR
            </button>
          </div>
        `;
        
        showMessage('message-container', `Buscando brutalidad para: "${escapeHtml(query)}"`, 'blood');
      });
      
      $('song-search').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          $('btn-search').click();
        }
      });
      
      // Sistema de ofrendas
      $('btn-send-gift').addEventListener('click', () => {
        playSound('click-sound');
        if (!currentUser) {
          showMessage('message-gifts', 'Entr√° con tu nombre de guerra primero.', 'flame');
          return;
        }
        
        const toNick = normalizeNickname($('gift-to').value);
        if (!toNick || toNick.length < 3) {
          showMessage('message-gifts', 'Ingres√° el apodo del headbanger.', 'blood');
          return;
        }
        
        // Simular env√≠o
        const giftType = $('gift-type').value;
        const amount = ECONOMY.baseGiftValues[giftType] || 10;
        
        currentUser.points += amount;
        updateProfileUI();
        
        createBloodExplosion(window.innerWidth / 2, window.innerHeight / 2, 80);
        createPointsAnimation(window.innerWidth / 2, window.innerHeight / 2, amount, "GOTAS");
        
        showMessage('message-gifts', `Ofrenda enviada a ${escapeHtml(toNick)} ¬∑ +${amount} gotas de sangre`, 'blood');
        $('gift-to').value = '';
      });
      
      // Ranking
      $('btn-open-leaderboard').addEventListener('click', () => {
        playSound('click-sound');
        alert(`RANKING INFERNAL\n\n1. ThrashMaster - 2,450 pts\n2. DeathScreamer - 2,120 pts\n3. MetalDestroyer - 1,980 pts\n4. BlackMetalFan - 1,750 pts\n5. ${currentUser?.nickname || 'T√∫'} - ${currentUser?.points || 666} pts`);
      });
      
      // Configurar datos de ejemplo
      $('top1').textContent = '#1 ThrashMaster ¬∑ 2,450 pts';
      $('top2').textContent = '#2 DeathScreamer ¬∑ 2,120 pts';
      $('top3').textContent = '#3 MetalDestroyer ¬∑ 1,980 pts';
      $('gift-count').textContent = '0';
      $('priority-mode').textContent = 'NORMAL';
    }
    
    // Funci√≥n para simular agregar canci√≥n
    window.simulateAddSong = function(button) {
      playSound('click-sound');
      if (!currentUser) {
        showMessage('message-container', 'Entr√° con tu nombre de guerra primero.', 'flame');
        return;
      }
      
      const originalText = button.innerHTML;
      button.disabled = true;
      button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> AGREGANDO...';
      
      setTimeout(() => {
        currentUser.points += ECONOMY.pointsPerSong;
        currentUser.songs_added = (currentUser.songs_added || 0) + 1;
        updateProfileUI();
        
        const rect = button.getBoundingClientRect();
        const x = rect.left + rect.width / 2;
        const y = rect.top + rect.height / 2;
        
        createBloodExplosion(x, y, 60);
        createPointsAnimation(x, y, ECONOMY.pointsPerSong, "PUNTOS");
        
        showMessage('message-container', `Canci√≥n agregada al infierno. +${ECONOMY.pointsPerSong} gotas de sangre`, 'blood');
        
        button.innerHTML = '<i class="fas fa-check"></i> AGREGADA';
        setTimeout(() => {
          button.disabled = false;
          button.innerHTML = originalText;
        }, 2000);
      }, 1500);
    };

    // Inicializar cuando el DOM est√© listo
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>